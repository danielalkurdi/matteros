{% extends "base.html" %}
{% block title %}Run {{ run.id[:8] }}{% endblock %}
{% block content %}
<h2>Run {{ run.id[:8] }}</h2>
<div class="card">
    <p><strong>Playbook:</strong> {{ run.playbook_name }}</p>
    <p><strong>Status:</strong>
        {% if run.status == "completed" %}<span class="badge badge-green">{{ run.status }}</span>
        {% elif run.status == "failed" %}<span class="badge badge-red">{{ run.status }}</span>
        {% else %}<span class="badge badge-yellow">{{ run.status }}</span>{% endif %}
    </p>
    <p><strong>Started:</strong> {{ run.started_at }}</p>
    <p><strong>Ended:</strong> {{ run.ended_at or "-" }}</p>
    <p><strong>Dry Run:</strong> {{ "yes" if run.dry_run else "no" }}</p>
    {% if run.error %}<p><strong>Error:</strong> <span style="color:var(--red)">{{ run.error }}</span></p>{% endif %}
</div>

<h2>Steps</h2>
<table>
    <thead><tr><th>Step</th><th>Type</th><th>Status</th><th>Started</th><th>Ended</th></tr></thead>
    <tbody>
        {% for step in steps %}
        <tr>
            <td>{{ step.step_id }}</td>
            <td>{{ step.step_type }}</td>
            <td>
                {% if step.status == "completed" %}<span class="badge badge-green">{{ step.status }}</span>
                {% elif step.status == "failed" %}<span class="badge badge-red">{{ step.status }}</span>
                {% else %}<span class="badge badge-yellow">{{ step.status }}</span>{% endif %}
            </td>
            <td>{{ step.started_at[:19] }}</td>
            <td>{{ (step.ended_at[:19] if step.ended_at else "-") }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<h2>Audit Events</h2>
<table>
    <thead><tr><th>Seq</th><th>Type</th><th>Actor</th><th>Step</th><th>Timestamp</th></tr></thead>
    <tbody>
        {% for event in events %}
        <tr>
            <td>{{ event.seq }}</td>
            <td>{{ event.event_type }}</td>
            <td>{{ event.actor }}</td>
            <td>{{ event.step_id or "-" }}</td>
            <td>{{ event.timestamp[:19] }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}
