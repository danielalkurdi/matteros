{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}
{% block content %}
<h2>Dashboard</h2>
<div class="stats">
    <div class="stat">
        <div class="value">{{ run_count }}</div>
        <div class="label">Total Runs</div>
    </div>
    <div class="stat">
        <div class="value">{{ pending_approvals }}</div>
        <div class="label">Pending Approvals</div>
    </div>
    <div class="stat">
        <div class="value">{{ config.llm.provider }}</div>
        <div class="label">LLM Provider</div>
    </div>
    <div class="stat">
        <div class="value">{{ config.profile.name }}</div>
        <div class="label">Profile</div>
    </div>
</div>

<h2>Recent Runs</h2>
<table>
    <thead>
        <tr><th>Run ID</th><th>Playbook</th><th>Status</th><th>Started</th><th>Dry Run</th></tr>
    </thead>
    <tbody>
        {% for run in recent_runs %}
        <tr>
            <td><a href="/runs/{{ run.id }}" style="color: var(--accent)">{{ run.id[:8] }}</a></td>
            <td>{{ run.playbook_name }}</td>
            <td>
                {% if run.status == "completed" %}<span class="badge badge-green">{{ run.status }}</span>
                {% elif run.status == "failed" %}<span class="badge badge-red">{{ run.status }}</span>
                {% else %}<span class="badge badge-yellow">{{ run.status }}</span>{% endif %}
            </td>
            <td>{{ run.started_at[:19] }}</td>
            <td>{{ "yes" if run.dry_run else "no" }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<div hx-ext="sse" sse-connect="/events/stream" sse-swap="message" hx-swap="beforeend" id="live-events" style="display:none;"></div>
{% endblock %}
